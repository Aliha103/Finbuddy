import{r as u,j as t,f as E,A as I,k as F,m as v,l as R}from"./index-CvOsVri7.js";async function M({isPersonal:i,members:m,purpose:d}){return new Promise(n=>setTimeout(()=>{!i&&m.length>3?n("AI: Bigger groups benefit from clear roles or budgets!"):n(d?"AI: Smart choice! Group expenses simplify shared spending.":"AI: Setting a clear group purpose helps avoid confusion later.")},450))}function B(i){u.useEffect(()=>{},[i])}function K({message:i}){return t.jsxs(v.div,{className:"ai-tip-banner",initial:{opacity:0,y:-15},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{duration:.38,type:"spring"},tabIndex:0,"aria-live":"polite",children:[t.jsx(R,{style:{marginRight:8,color:"#ffdb5e"}}),i]})}const L={isPersonal:!0,groupName:"",members:[],memberInput:"",purpose:""};function D({onCreate:i,onCancel:m,existingGroups:d=[]}){const[n,b]=u.useState(1),[s,l]=u.useState(L),[h,C]=u.useState(""),[a,o]=u.useState({}),p=u.useRef(null),f=u.useRef(null);B(s),u.useEffect(()=>{let e=!1;return M(s).then(r=>!e&&C(r)),()=>{e=!0}},[n,s]);function g(e){return d.map(r=>r.toLowerCase().trim()).includes(e.toLowerCase().trim())}function j(e){l(r=>({...r,isPersonal:e,members:e?[]:r.members})),o({})}function k(e){l(r=>({...r,groupName:e.target.value})),o(r=>({...r,groupName:void 0}))}function N(){const e=s.memberInput.trim();if(e){if(s.members.includes(e)){o(r=>({...r,memberInput:"Member already added."}));return}l(r=>({...r,members:[...r.members,e],memberInput:""})),o(r=>({...r,memberInput:void 0})),setTimeout(()=>{var r;return(r=p.current)==null?void 0:r.focus()},1)}}function P(e){l(r=>({...r,memberInput:e.target.value})),o(r=>({...r,memberInput:void 0}))}function A(e){l(r=>({...r,members:r.members.filter(c=>c!==e)}))}function G(){let e={};s.groupName.trim()?g(s.groupName)&&(e.groupName="You already joined/created a group with this name"):e.groupName="Group name required",!s.isPersonal&&s.members.length<1&&(e.members="Add at least one member"),s.purpose.trim()||(e.purpose="Purpose is required"),o(e),!Object.keys(e).length&&i&&i({...s})}function T(){let e={};s.groupName.trim()?g(s.groupName)&&(e.groupName="You already joined/created a group with this name"):e.groupName="Group name required",o(e),!Object.keys(e).length&&(b(2),setTimeout(()=>{var r,c;s.isPersonal?(c=f.current)==null||c.focus():(r=p.current)==null||r.focus()},10))}function S(e){e.key==="Enter"&&(e.preventDefault(),N())}function w(e){l(r=>({...r,purpose:e.target.value})),o(r=>({...r,purpose:void 0}))}function y(){b(n===2&&s.isPersonal?1:n-1),o({}),setTimeout(()=>{var e,r;n===2&&s.isPersonal||(n===2&&((e=p.current)==null||e.focus()),n===3&&((r=f.current)==null||r.focus()))},10)}function x({children:e,stepKey:r}){return t.jsx(I,{mode:"wait",initial:!1,children:t.jsx(v.div,{initial:{x:60,opacity:0},animate:{x:0,opacity:1},exit:{x:-40,opacity:0},transition:{type:"spring",stiffness:280,damping:22},className:"group-step",children:e},r)})}return t.jsx("div",{className:"create-group-popup",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"popup-content",children:[t.jsx("button",{className:"close-btn",onClick:m,tabIndex:0,children:"✕"}),t.jsxs("h2",{children:[t.jsx(E,{})," Create New ",s.isPersonal?"Personal":"Group"," ","Expense"]}),t.jsx(I,{children:h&&t.jsx(K,{message:h},h)}),n===1&&t.jsxs(x,{stepKey:"step1",children:[t.jsxs("div",{className:"type-selector",children:[t.jsx("button",{className:s.isPersonal?"selected":"",onClick:()=>j(!0),tabIndex:0,type:"button",children:"Personal"}),t.jsx("button",{className:s.isPersonal?"":"selected",onClick:()=>j(!1),tabIndex:0,type:"button",children:"Group"})]}),t.jsxs("label",{children:["Group Name",t.jsx("input",{type:"text",value:s.groupName,onChange:k,placeholder:"e.g. Venice Trip, Flatmates",autoFocus:!0,className:a.groupName?"input-error":""}),a.groupName&&t.jsx("span",{className:"error",children:a.groupName})]}),t.jsx("div",{className:"group-actions",children:t.jsx("button",{onClick:T,tabIndex:0,type:"button",children:"Next"})})]}),!s.isPersonal&&n===2&&t.jsxs(x,{stepKey:"step2",children:[t.jsxs("label",{children:["Add Group Members (name, nickname, etc):",t.jsxs("div",{className:"member-input-wrap",children:[t.jsx("input",{className:`group-member-input${a.memberInput?" input-error":""}`,ref:p,value:s.memberInput,onChange:P,onKeyDown:S,placeholder:"Type name and press Enter",autoFocus:!0}),t.jsxs("button",{onClick:N,tabIndex:0,type:"button",className:"add-member-btn",children:[t.jsx(F,{})," Add"]})]}),a.memberInput&&t.jsx("span",{className:"error",children:a.memberInput})]}),t.jsxs("div",{className:"members-list",children:[s.members.map(e=>t.jsxs("div",{className:"member-chip",children:[e,t.jsx("button",{onClick:()=>A(e),"aria-label":"Remove",type:"button",children:"×"})]},e)),a.members&&t.jsx("span",{className:"error",children:a.members})]}),t.jsxs("div",{className:"group-actions",children:[t.jsx("button",{onClick:y,tabIndex:0,type:"button",children:"Back"}),t.jsx("button",{onClick:()=>b(3),tabIndex:0,type:"button",children:"Next"})]})]}),s.isPersonal&&n===2||!s.isPersonal&&n===3?t.jsxs(x,{stepKey:"step3",children:[t.jsxs("label",{children:["Group Purpose",t.jsx("input",{ref:f,type:"text",value:s.purpose,onChange:w,placeholder:"e.g. Flat Expenses, Trip Budget, Office Lunch",className:a.purpose?"input-error":"",autoFocus:!0}),a.purpose&&t.jsx("span",{className:"error",children:a.purpose})]}),t.jsxs("div",{className:"group-actions",children:[t.jsx("button",{onClick:y,tabIndex:0,type:"button",children:"Back"}),t.jsx("button",{onClick:G,tabIndex:0,type:"button",children:"Create Group"})]})]}):null]})})}export{D as default};
